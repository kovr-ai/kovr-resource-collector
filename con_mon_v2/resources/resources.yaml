# Resources configuration file
# Defines resource structures for different providers

github:
  nested_schemas:
    # Nested data type schemas
    repository_data:
      description: "Repository basic information and metadata"
      fields:
        basic_info:
          id: "integer"
          name: "string"
          full_name: "string"
          description: "string"
          private: "boolean"
          owner: "string"
          html_url: "string"
          clone_url: "string"
          ssh_url: "string"
          size: "integer"
          language: "string"
          created_at: "string"
          updated_at: "string"
          pushed_at: "string"
          stargazers_count: "integer"
          watchers_count: "integer"
          forks_count: "integer"
          open_issues_count: "integer"
          archived: "boolean"
          disabled: "boolean"
        metadata:
          default_branch: "string"
          topics: "array"
          has_issues: "boolean"
          has_projects: "boolean"
          has_wiki: "boolean"
          has_pages: "boolean"
          has_downloads: "boolean"
          has_discussions: "boolean"
          is_template: "boolean"
          license: "string"
          visibility: "string"
          allow_forking: "boolean"
          web_commit_signoff_required: "boolean"
        branches:
          type: "array"  # List of branch objects
          structure:
            name: "string"
            sha: "string"
            protected: "boolean"
        statistics:
          total_commits: "integer"
          contributors_count: "integer"
          languages:
            type: "object"  # Dictionary of language -> bytes
            structure:
              Python: "integer"
              JavaScript: "integer"
          code_frequency: "array"

    actions_data:
      description: "GitHub Actions workflows and runs"
      fields:
        workflows:
          type: "object"  # Dictionary/map of workflow_id -> workflow_data
          structure:
            id: "integer"
            name: "string"
            path: "string"
            state: "string"
            created_at: "string"
            updated_at: "string"
            url: "string"
            html_url: "string"
            badge_url: "string"
        total_workflows: "integer"
        active_workflows: "integer"
        recent_runs_count: "integer"

    collaboration_data:
      description: "Collaboration information - issues, PRs, collaborators"
      fields:
        issues:
          type: "array"  # List of issue objects
          structure:
            number: "integer"
            title: "string"
            state: "string"
            user: "string"
            created_at: "string"
            updated_at: "string"
            closed_at: "string"
            labels: "array"
            assignees: "array"
            comments_count: "integer"
            is_pull_request: "boolean"
        pull_requests:
          type: "array"  # List of pull request objects
          structure:
            number: "integer"
            title: "string"
            state: "string"
            user: "string"
            created_at: "string"
            updated_at: "string"
            closed_at: "string"
            merged_at: "string"
            base_branch: "string"
        collaborators:
          type: "array"  # List of collaborator objects
          structure:
            login: "string"
            permissions:
              admin: "boolean"
              maintain: "boolean"
              push: "boolean"
              pull: "boolean"
              triage: "boolean"
            role_name: "string"
        total_issues: "integer"
        open_issues: "integer"
        closed_issues: "integer"
        total_pull_requests: "integer"
        open_pull_requests: "integer"
        merged_pull_requests: "integer"
        draft_pull_requests: "integer"
        total_collaborators: "integer"

    security_data:
      description: "Security advisories, alerts and analysis"
      fields:
        security_advisories:
          type: "object"
          structure:
            error: "string"  # May contain error message
            advisories: "array"
        vulnerability_alerts:
          type: "object"
          structure:
            enabled: "boolean"
            dependabot_alerts:
              type: "array"
              structure:
                number: "integer"
                state: "string"
                severity: "string"
                package: "string"
                created_at: "string"
                updated_at: "string"
            error: "string"
        dependency_graph:
          type: "object"
          structure:
            has_vulnerability_alerts_enabled: "boolean"
            security_and_analysis:
              advanced_security: "string"
              secret_scanning: "string"
              secret_scanning_push_protection: "string"
        security_analysis:
          advanced_security_enabled: "boolean"
          secret_scanning_enabled: "boolean"
          push_protection_enabled: "boolean"
          dependency_review_enabled: "boolean"
        code_scanning_alerts:
          type: "object"
          structure:
            error: "string"
            alerts: "array"
        total_advisories: "integer"
        total_dependabot_alerts: "integer"
        total_code_scanning_alerts: "integer"
        security_features_enabled: "integer"

    organization_data:
      description: "Organization members, teams and collaborators"
      fields:
        members: "array"  # List of member objects (often empty)
        teams: "array"   # List of team objects (often empty)
        outside_collaborators: "array"  # List of collaborator objects (often empty)
        total_members: "integer"
        total_teams: "integer"
        total_outside_collaborators: "integer"
        admin_members: "integer"
        members_error: "string"
        teams_error: "string"
        collaborators_error: "string"

    advanced_features_data:
      description: "Advanced GitHub features - tags, webhooks"
      fields:
        tags:
          type: "array"  # List of tag objects
          structure:
            name: "string"
            commit_sha: "string"
            commit_date: "string"
        webhooks: "array"  # List of webhook objects (often empty)
        total_tags: "integer"
        total_webhooks: "integer"
        active_webhooks: "integer"
        tags_error: "string"
        webhooks_error: "string"

  resources:
    # Main resource schemas
    GithubResource:
      # Define the structure that matches GitHub API response with all data types
      fields:
        id: "string"  # Repository name to be used as ID for easy identification
        repository_data: "github.nested_schemas.repository_data"  # Nested Pydantic model
        actions_data: "github.nested_schemas.actions_data"        # Nested Pydantic model
        collaboration_data: "github.nested_schemas.collaboration_data"  # Nested Pydantic model
        security_data: "github.nested_schemas.security_data"      # Nested Pydantic model
        organization_data: "github.nested_schemas.organization_data"    # Nested Pydantic model
        advanced_features_data: "github.nested_schemas.advanced_features_data"  # Nested Pydantic model

  resource_collection:
    # Define the structure for GitHub resource collections
    fields:
      resource_schemas:
        - "github.resources.GithubResource"
      source_connector: "string"
      total_count: "integer"
      fetched_at: "string"
      collection_metadata:
        authenticated_user: "string"
        total_repositories: "integer"
        total_workflows: "integer"
        total_issues: "integer"
        total_pull_requests: "integer"
        total_security_alerts: "integer"
        total_collaborators: "integer"
        total_tags: "integer"
        total_active_webhooks: "integer"
      github_api_metadata:
        collection_time: "string"
        api_version: "string"
        scope: "array"

aws:
  resources:
    # AWS EC2 Resource Schema
    EC2Resource:
      fields:
        # Account-level information
        account:
          limits:
            type: "object"  # Dictionary of limit_name -> limit_value
            structure:
              supported-platforms: "string"
              vpc-max-security-groups-per-interface: "string"
              max-elastic-ips: "string"
              max-instances: "string"
              vpc-max-elastic-ips: "string"
              default-vpc: "string"
          reserved_instances: "array"
          spot_instances: "array"
        # EC2 resources
        instances:
          type: "object"  # Dictionary/map of instance_id -> instance_data
          structure:
            instance_type: "string"
            state: "string"
            launch_time: "string"
            image_id: "string"
            vpc_id: "string"
            subnet_id: "string"
            availability_zone: "string"
            key_name: "string"
            platform: "string"
            monitoring: "string"
            iam_instance_profile:
              type: "object"
              structure:
                Arn: "string"
                Id: "string"
            ebs_optimized: "boolean"
            instance_lifecycle: "string"
            security_groups: "array"
            network_interfaces: "array"
            block_device_mappings: "array"
        security_groups:
          type: "object"  # Dictionary/map of group_id -> security_group_data
          structure:
            group_name: "string"
            description: "string"
            vpc_id: "string"
            inbound_rules: "array"
            outbound_rules: "array"
        vpcs:
          type: "object"  # Dictionary/map of vpc_id -> vpc_data
          structure:
            cidr_block: "string"
            state: "string"
            dhcp_options_id: "string"
            instance_tenancy: "string"
            is_default: "boolean"
            cidr_block_association_set: "array"
        subnets:
          type: "object"  # Dictionary/map of subnet_id -> subnet_data
          structure:
            vpc_id: "string"
            availability_zone: "string"
            availability_zone_id: "string"
            cidr_block: "string"
            state: "string"
        route_tables:
          type: "object"  # Dictionary/map of route_table_id -> route_table_data
          structure:
            vpc_id: "string"
            routes: "array"
            associations: "array"
        nat_gateways:
          type: "object"  # Dictionary/map of nat_gateway_id -> nat_gateway_data
          structure:
            state: "string"
            subnet_id: "string"
            vpc_id: "string"
            create_time: "string"
            delete_time: "string"
        elastic_ips:
          type: "object"  # Dictionary/map of allocation_id -> eip_data
          structure:
            public_ip: "string"
            domain: "string"
            instance_id: "string"
            network_interface_id: "string"
            private_ip_address: "string"
        key_pairs:
          type: "object"  # Dictionary/map of key_name -> key_pair_data
          structure:
            key_fingerprint: "string"
            key_type: "string"
        snapshots:
          type: "object"  # Dictionary/map of snapshot_id -> snapshot_data
          structure:
            volume_id: "string"
            volume_size: "integer"
            state: "string"
            start_time: "string"
            progress: "string"
        volumes:
          type: "object"  # Dictionary/map of volume_id -> volume_data
          structure:
            size: "integer"
            volume_type: "string"
            state: "string"
            availability_zone: "string"
            create_time: "string"
            encrypted: "boolean"
            iops: "integer"
            throughput: "integer"
        network_interfaces:
          type: "object"  # Dictionary/map of network_interface_id -> interface_data
          structure:
            subnet_id: "string"
            vpc_id: "string"
            availability_zone: "string"
            description: "string"
            interface_type: "string"
            private_ip_address: "string"
            private_dns_name: "string"
            source_dest_check: "boolean"
            status: "string"
            mac_address: "string"
            security_groups: "array"
        internet_gateways:
          type: "object"  # Dictionary/map of internet_gateway_id -> gateway_data
          structure:
            state: "string"
            attachments: "array"

    # AWS IAM Resource Schema
    IAMResource:
      fields:
        # IAM resources
        users:
          type: "object"  # Dictionary/map of user_arn -> user_data
          structure:
            arn: "string"
            user_id: "string"
            create_date: "string"
            path: "string"
            access_keys: "array"
            mfa_devices: "array"
        policies:
          type: "object"  # Dictionary/map of policy_arn -> policy_data
          structure:
            policy_name: "string"
            policy_id: "string"
            create_date: "string"
            update_date: "string"
            path: "string"
            default_version_id: "string"
            attachment_count: "integer"
            default_version:
              Document:
                Version: "string"
                Statement: "array"
              VersionId: "string"
              IsDefaultVersion: "boolean"
              CreateDate: "string"

    # AWS S3 Resource Schema
    S3Resource:
      fields:
        # S3 resources
        buckets:
          type: "object"  # Dictionary/map of bucket_name -> bucket_data
          structure:
            name: "string"
            creation_date: "string"
            region: "string"

    # AWS CloudTrail Resource Schema
    CloudTrailResource:
      fields:
        # CloudTrail resources
        trails:
          type: "object"  # Dictionary/map of trail_name -> trail_data
          structure:
            name: "string"
            s3_bucket_name: "string"
            s3_key_prefix: "string"
            include_global_service_events: "boolean"
            is_multi_region_trail: "boolean"
            enable_log_file_validation: "boolean"
            event_selectors: "array"
            insight_selectors: "array"
            is_logging: "boolean"
            kms_key_id: "string"

    # AWS CloudWatch Resource Schema
    CloudWatchResource:
      fields:
        # CloudWatch resources
        log_groups:
          type: "object"  # Dictionary/map of log_group_name -> log_group_data
          structure:
            log_group_name: "string"
            creation_time: "integer"
            retention_in_days: "integer"
            metric_filter_count: "integer"
            arn: "string"
            stored_bytes: "integer"
            kms_key_id: "string"
        metrics: 
          type: "array"  # List of metric objects
          structure:
            namespace: "string"
            metric_name: "string"  
            dimensions:
              type: "array"
              structure:
                Name: "string"
                Value: "string"
        alarms:
          type: "object"  # Dictionary/map of alarm_name -> alarm_data
          structure:
            alarm_name: "string"
            alarm_description: "string"
            actions_enabled: "boolean"
            ok_actions: "array"
            alarm_actions: "array"
            insufficient_data_actions: "array"
            state_value: "string"
            state_reason: "string"
            state_updated_timestamp: "string"
            metric_name: "string"
            namespace: "string"
            statistic: "string"
            dimensions:
              type: "array"
              structure:
                Name: "string"
                Value: "string"
            period: "integer"
            evaluation_periods: "integer"
            threshold: "number"
            comparison_operator: "string"
        dashboards:
          type: "object"  # Dictionary/map of dashboard_name -> dashboard_data
          structure:
            dashboard_name: "string"
            dashboard_arn: "string"
            dashboard_body: "string"
            size: "integer"
            last_modified: "string"

  resource_collection:
    # Define the structure for AWS resource collections
    fields:
      resource_schemas:
        - "aws.resources.EC2Resource"
        - "aws.resources.IAMResource"
        - "aws.resources.S3Resource"
        - "aws.resources.CloudTrailResource"
        - "aws.resources.CloudWatchResource"
      source_connector: "string"
      total_count: "integer"
      fetched_at: "string"
      collection_metadata:
        account_id: "string"
        regions: "array"
        services_collected: "array"
        collection_errors: "array"
      aws_api_metadata:
        collection_time: "string"
        api_version: "string"
        services: "array"
        regions_scanned: "array"
