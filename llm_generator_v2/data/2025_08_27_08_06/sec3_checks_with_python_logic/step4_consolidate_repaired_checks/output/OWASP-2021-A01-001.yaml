checks:
  unique_id: "OWASP-2021-A01-001"
  name: "Branch protection enabled"
  literature: "Verify that GitHub repositories have branch protection enabled on main branches"
  category: "access_control"
  output_statements:
    success: "Branch protection is properly configured for main branch"
    failure: "Main branch lacks required protection settings"
    partial: "Some protection rules are configured but incomplete"
  fix_details:
    description: "Enable branch protection rules for the main branch"
    instructions:
      - "Navigate to repository Settings > Branches"
      - "Add branch protection rule for main/master branch"
      - "Enable required status checks and review requirements"
    estimated_time: "5-10 minutes"
    automation_available: true
  resource:
    name: "GitHub::Repo"
    field_path: "repo.basic_info.branches[].protected"
    logic: |
      def check_branch_protection(repo):
          try:
              branches = repo.get("basic_info", {}).get("branches", [])
              main_branches = ["main", "master"]
              
              for branch in branches:
                  branch_name = branch.get("name", "").lower()
                  if branch_name in main_branches:
                      if not branch.get("protected", False):
                          return {
                              "status": "FAIL", 
                              "message": f"Branch '{branch.get('name')}' is not protected"
                          }
                          
              return {
                  "status": "PASS",
                  "message": "Main branch protection is properly configured"
              }
              
          except Exception as e:
              return {
                  "status": "FAIL",
                  "message": f"Error checking branch protection: {str(e)}"
              }
  tags:
    - "branch_protection"
    - "github"
    - "access_control"
  severity: "high"
