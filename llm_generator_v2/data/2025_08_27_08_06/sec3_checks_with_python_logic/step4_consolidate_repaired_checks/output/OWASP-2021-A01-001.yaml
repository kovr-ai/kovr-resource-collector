checks:
  unique_id: "OWASP-2021-A01-001"
  name: "Branch protection enabled"
  literature: "Verify that GitHub repositories have branch protection enabled on main branches"
  category: "access_control"
  output_statements:
    success: "Branch protection is properly configured for main branch"
    failure: "Main branch lacks required protection settings"
    partial: "Some protection rules are configured but incomplete"
  fix_details:
    description: "Enable branch protection rules for the main branch"
    instructions:
      - "Navigate to repository Settings > Branches"
      - "Add branch protection rule for main/master branch"
      - "Enable required status checks and review requirements"
    estimated_time: "5-10 minutes"
    automation_available: true
  resource:
    name: "GitHub::Repo"
    field_path: "repo.basic_info.branches[]"
    logic: |
      def check_branch_protection(fetched_value):
          """
          Check if main/master branches have branch protection enabled
          
          Args:
              fetched_value: List of branch dictionaries
              
          Returns:
              bool: True if passed, False if failed
          """
          main_branches = ["main", "master"]
          
          for branch in fetched_value:
              branch_name = branch.get("name", "").lower()
              if branch_name in main_branches:
                  if not branch.get("protected", False):
                      return False
                      
          # If we get here, all main branches are protected
          return True
  tags:
    - "branch_protection"
    - "github"
    - "access_control"
  severity: "high"
